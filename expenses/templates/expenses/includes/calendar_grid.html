<div class="calendar-grid">
    <!-- Weekday headers -->
    <div class="calendar-weekday {% if current_weekday == 0 %}calendar-weekday--today{% endif %}">Mon</div>
    <div class="calendar-weekday {% if current_weekday == 1 %}calendar-weekday--today{% endif %}">Tue</div>
    <div class="calendar-weekday {% if current_weekday == 2 %}calendar-weekday--today{% endif %}">Wed</div>
    <div class="calendar-weekday {% if current_weekday == 3 %}calendar-weekday--today{% endif %}">Thu</div>
    <div class="calendar-weekday {% if current_weekday == 4 %}calendar-weekday--today{% endif %}">Fri</div>
    <div class="calendar-weekday calendar-weekday--weekend {% if current_weekday == 5 %}calendar-weekday--today{% endif %}">Sat</div>
    <div class="calendar-weekday calendar-weekday--weekend {% if current_weekday == 6 %}calendar-weekday--today{% endif %}">Sun</div>
    
    <!-- Calendar days -->
    {% for week in calendar_weeks %}
        {% for day in week %}
            {% if day == 0 %}
                <div class="calendar-day calendar-day--empty"></div>
            {% else %}
                {% with day_index=forloop.counter0 %}
                <div class="calendar-day 
                    {% if month and month.year == today.year and month.month == today.month and day == today.day %}calendar-day--today{% elif not month and day == today.day %}calendar-day--today{% endif %}
                    {% if month and month.year == today.year and month.month == today.month and day < today.day %}calendar-day--past{% elif not month and day < today.day %}calendar-day--past{% endif %}
                    {% if month and month.year == today.year and month.month == today.month and day > today.day %}calendar-day--future{% elif not month and day > today.day %}calendar-day--future{% endif %}
                    {% if day_index == 5 or day_index == 6 %}calendar-day--weekend{% endif %}
                    {% if day in due_days %}calendar-day--has-due{% endif %}">
                    {{ day }}
                </div>
                {% endwith %}
            {% endif %}
        {% endfor %}
    {% endfor %}
</div>